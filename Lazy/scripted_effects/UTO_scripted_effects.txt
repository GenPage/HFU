# Creates Tabitha as a general for the current scope.
create_general_tabitha = {
	if = {
		# For the love of all that is holy, only one Tabitha at a time.
		limit = {
			NOT = { has_variable = global.general_tabitha_created }
		}
		set_variable = { global.general_tabitha_created = yes }
		create_corps_commander = {
			name = "Tabitha"
			portrait_path = "gfx/leaders/UTO/portrait_tabitha.dds"
			traits = { ambusher }
			skill = 3
			attack_skill = 4
			defense_skill = 3
			planning_skill = 2
			logistics_skill = 2
		}
	}
}

# Spawns a unit of elite supermutants - 'nightkin' - and three units of
# supermutant regulars - 'dumbdumbs'.
spawn_tabithas_guard = {
	custom_effect_tooltip = spawn_tabithas_guard_tt
	hidden_effect = {
		load_oob = UTO_tabithas_guard
	}
}

# Called at the beginning of the game if the Utobitha game rule is enabled.
become_utobitha = {
	random_owned_state = {
		UTO = {
			add_state_core = PREV
			transfer_state = PREV
		}
	}

	if = {
		limit = { is_ai = no }
		UTO = { change_tag_from = MOJ }

		country_event = {
			id = uto_decision_events.3
			hours = 1
		}
	}
	else = {
		transfer_utobithan_territory = yes
		setup_utobithan_military = yes
	}
}

transfer_utobithan_territory = {
	# Transfer every Utobithan core state owned by the spawner over to
	# Utobitha.
	hidden_effect = {
		every_state = {
			limit = {
				is_new_vegas_state = yes
				is_owned_by = PREV
			}
			UTO = {
				add_state_core = PREV
				transfer_state = PREV
			}
		}
	}
}

claim_missing_utobithan_territory = {
	hidden_effect = {
		every_state = {
			limit = {
				is_new_vegas_state = yes
				NOT = { is_owned_by = UTO }
			}
			UTO = { add_state_claim = PREV }
		}
	}
}

# Creates the State of Utobitha! Will use the calling scope via PREV to
# determine who is creating Utobitha - this will generally be one of the other
# supermutant factions.

# Basically, the State of Utobitha will appear within all Mojave territory
# currently owned by the spawner. The State of Utobitha will also gain cores on
# all of the Mojave that they can be given directly, and gain claims on the
# rest.
release_utobitha_as_puppet = {
	custom_effect_tooltip = create_the_state_of_utobitha_tt

	transfer_utobithan_territory = yes
	claim_missing_utobithan_territory = yes
	puppet = UTO

	custom_effect_tooltip = spacer_tt
	setup_utobithan_military = yes
}

setup_utobithan_military = {
	# Set up Tabitha and her military.
	UTO = {
		hidden_effect = {
			set_supermutant_nation = yes
		}
		create_general_tabitha = yes
		spawn_tabithas_guard = yes

		# Needed to keep Tabitha in charge.
		# Most players probably expect her to stay in charge, even if they're
		# playing as The First & Pittman (i.e., a supermutant non-ruler leader).
		# Hidden, as it's a bit confusing looking and is what folks expect anyhow.
		hidden_effect = {
			set_politics = {
				ruling_party = ruler
				elections_allowed = no
			}
			set_popularities = {
				people = 0
				elites = 0
				intellectuals = 0
				ruler = 100
			}
		}
	}
}
# vim: set ft=pdx tw=79 :
